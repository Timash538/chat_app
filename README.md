# console-chat
Финальный экзамен по курсу "Программист C++"

Мессенджер с несколькими чатами.

Участник Тимур Шайхрамов.



Реализация мессенджера:
Сервер:
1 I/O поток (asio библиотека), принимает/отправляет запросы/ответы пользователям.
Thread pool - несколько (сколько позволяет машина -(минус) 1) поток (1 поток резервируем для I/O). Для обработки запросов не мешая I/O. После обработки ответ кидается через I/O клиенту обратно.
Map user_id - Connections для рассылки, киков, доступа к онлайн юзерам. (Можно реализовать подсветку зеленым юзеров, кто онлайн).
Database - просто обрабатывает запросы и общается с psql. (Нужно реализовать ConnectionPool, чтобы можно было параллельно обращаться к БД, а пока на mutex
и все ждут пока один поток общается с БД (Поэтому это самое медленное место в программе))
Репозитории - для разграничения запросов по логике.
Models - DTO. - Репозитории и DTO взяты из опыта с Java.
CommandRegistry - регистрируем запросы на сервере. Клиент может отправить команду login, a requestHandler отправит запрос CommandRegistry и он уже разберется, есть ли такая команда и как ее обработать.
Handlers - функции обработчики.
Общение с клиентом происходит посредством перекидывания JSON'ов по голому TCP сокету (без TLS). Можно вообще REST реализовать, чтобы запросы были вида GET localhost.com/api/users/{id}..
Все ошибки возвращаются клиенту в виде JSON {{"error", error}} - легко обрабатывать. В handler'ах просто throw - и все, у клиента всплывает окно что не так.

Qt чем больше пользуешься - тем проще, рефакторить нужно много. Пишу в последний момент..

Клиент:
Логин/Регистрация. Есть кнопка для смены режимов. При регистрации кидает сразу в Login.
При хорошем логине и пароле - попадаем в MainWindow. 
Двойное нажатие на пользователе - создает чат с ним и оно отображается в чатах. Двойное нажатие по чату - открывается окно с чатами/добавляется вкладка в окно с чатами. 
(Там уже подгружается история сообщений итд)
Чтобы создать общий чат, надо выбрать несколько пользователей, вписать название чата и жмать кнопку создать общий чат, если ошибиться - выйдет окно и скажет что не так.

ServerGUI:
Все просто. Один раз нажал на юзера - можно забанить/разбанить на одну кнопку, на другую - кикнуть. При бане - тоже кик. Надо в клиенте еще сделать при разрыве соединения чтобы попыталось соединиться
(но перед этим выкинуть в Логин). Можно и не выкидывать в логин если хранить сессии (это было в планах)


Чтобы запустить:
Для запуска сервера необходима поднятая БД на сервере psql. Credentials захардкожены в Server.cpp (не успеваю реализовать доставальщик из файлика нужных параметров...)
CMakePresets.json - Указать папку, где находится vcpkg. (C:/vcpkg прим.)
Если есть docker и он запущен - можно запустить test_with_docker.bat - соберет и запустит 1 экземпляр сервера, 2 экземпляра клиента, 1 экземпляр GUI для управления сервером
build_preset.bat - соберет проект. Бинарники лежат в build/preset/bin/Debug.
Либо:
cmake --preset x64-Debug
cmake --build --preset x64-Debug
Debug можно поменять на Release, но я не знаю как заставить генератор VS выдавать Release версию. Все равно выдает версию Debug.. (Тут я не особо понимаю почему) 
(С помощью Ninja можно сделать Release, но ему надо показывать где лежит Qt либы, чего я делать не стал)
Для psql есть init.sql в папке scripts.
